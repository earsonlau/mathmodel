/*!
 * TrakkSocial 0.4.1 - GTM Version
 * http://www.trakken.de/
 *
 * Copyright 2013, Trakken Web Services GmbH
 * JÃ¶rg Tillmann
 * Matthias Gutenkunst
 * 
 * Licensed under the MIT license.
 */
var TrakkSocialGTM=function(e,t,n){var r=false;var i=e.dataLayer||[];var s=function(t){var t=t||{};var i={facebook:true,twitter:true,linkedin:false,xing:false,custom:false,embed:false,debug:false};for(option in i){if(i.hasOwnProperty(option)){if(t[option]==n){t[option]=i[option]}}}if(v(e.location.href,"trakkSocialDebug")==="1"||t.debug){r=true}if(t.facebook){u(t.facebook,t.embed)}if(t.twitter){a(t.twitter,t.embed)}if(t.linkedin){f(t.linkedin,t.embed)}if(t.addthis||t.xing||t.custom){o(t,t.embed)}};var o=function(e){m(function(){var n=t.getElementsByTagName("a");for(var r=n.length-1;r>=0;r--){if(e.addthis){l(n[r])}if(e.xing){c(n[r])}if(e.custom){h(n[r])}}})};var u=function(n,r){if(r){y("Embedding Facebook script");if(!t.getElementById("fb-root")){var s=t.createElement("div");s.id="fb-root";t.getElementsByTagName("body")[0].appendChild(s)}d("//connect.facebook.net/en_US/all.js#xfbml=1","fb-root")}y("Enqueueing Facebook tracking");p(function(){try{FB&&FB.Event&&FB.Event.subscribe}catch(t){return false}y("Binding Facebook tracking");var r={like:"edge.create",unlike:"edge.remove",share:"messages.send"};for(intent in r){if(n===true||n[intent]!==false){FB.Event.subscribe(r[intent],function(t){return function(r,s){if(n.fbref&&s&&s["_attr"]&&s["_attr"].ref){if(r.indexOf("?")===-1){r+="?fbref="+s["_attr"].ref}else{r+="&fbref="+s["_attr"].ref}}y("Tracked Facebook interaction ("+t+") with "+r);i.push({socialNetwork:"facebook",socialAction:t,socialTarget:r,event:"social"});if(n.fbrefevent===true){var o=v(e.location.href,"fb_ref");if(o){i.push({event:"fbref",eventCategory:"TrakkSocial",eventAction:"fbref",eventLabel:o,eventValue:null,eventNonInteraction:true})}}if(n.fbsourceevent===true){var o=v(e.location.href,"fb_source");if(o){i.push({event:"fbsource",eventCategory:"TrakkSocial",eventAction:"fbsource",eventLabel:o,eventValue:null,eventNonInteraction:true})}}}}(intent))}}return true})};var a=function(e,t){if(t){y("Embedding Twitter script");d("//platform.twitter.com/widgets.js")}y("Enqueueing Twitter tracking");p(function(){try{twttr&&twttr.events&&twttr.events.bind}catch(t){return false}y("Binding Twitter tracking");var n=["tweet","retweet","favorite","follow"];for(var r=0;r<n.length;r++){var s=n[r];if(e===true||e[s]!==false){twttr.events.bind(s,function(e){if(e){var t;if(e.target&&e.target.nodeName=="IFRAME"){t=v(e.target.src,"url")}y("Tracked Twitter interaction ("+e.type+")");i.push({socialNetwork:"twitter",socialAction:e.type,socialTarget:t,event:"social"})}})}}return true})};var f=function(n,r){if(r){y("Embedding LinkedIn script");d("//platform.linkedin.com/in.js")}y("Enqueueing LinkedIn tracking");p(function(){try{IN}catch(n){return false}y("Binding LinkedIn tracking!");var r=t.getElementsByTagName("script");for(var s=0;s<r.length;s++){if(r[s].type.toLowerCase().indexOf("in/share")>=0&&r[s].getAttribute("data-success")){e[r[s].getAttribute("data-success")]=function(){y("Tracked LinkedIn interaction (share)");i.push({socialNetwork:"linkedin",socialAction:"share",event:"social"})};break}}return true})};var l=function(e){var t=e.getAttribute("addthis:url");if(t!=null){y("Binding AddThis tracking");var n=e.className.match(/addthis_button_([^\s\"]*)/);if(n&&n.length>=2){n=n[1];g(e,function(e,t){y("Tracked Addthis interaction ("+e+")");i.push({socialNetwork:"addthis",socialAction:e,socialTarget:t,event:"social"})})}}};var c=function(e){if(e.href.match(/https:\/\/www\.xing\.com\/app\/user(.*?)op=share/i)){y("Binding Xing tracking");g(e,function(){y("Tracked Xing interaction (share)");i.push({socialNetwork:"xing",socialAction:"share",socialTarget:v(e.href,"url"),event:"social"})})}};var h=function(t){data=t.getAttribute("data-trakksocial");if(data){y("Binding Custom Social tracking");data=data.split(",",3);if(data.length<2){return}g(t,function(){y("Tracked "+data[0]+" interaction ("+data[1]+")");data.unshift("_trackSocial");if(data.length===3){data.push(e.location.href)}i.push({socialNetwork:data[1],socialAction:data[2],socialTarget:data[3],event:"social"})})}};var p=function(t,n){var n=n||{};var r=n.limit||40;var i=n.interval||250;var s=0;(function(){if(r===-1||r>s++){if(false==t()){e.setTimeout(arguments.callee,i)}else if(n.success){n.success()}}else if(n.failure){n.failure()}})()};var d=function(e,n){m(function(){var r=t.createElement("script");r.type="text/javascript";r.async=true;r.src=e;if(n){t.getElementById(n).appendChild(r)}else{(t.getElementsByTagName("head")[0]||t.getElementsByTagName("body")[0]).appendChild(r)}})};var v=function(e,t){if(!e){return}var e=e.split("#")[0];var n=e.split("?");if(n.length==1){return false}var r=decodeURI(n[1]).replace(";","&");t+="=";var i=r.split("&");for(var s=0,o;o=i[s];++s){if(o.indexOf(t)===0){return unescape(o.split("=")[1])}}return false};var m=function(t){var n=e.onload;if(typeof e.onload!="function"){e.onload=t}else{e.onload=function(){if(n){n()}t()}}};var g=function(e,t){var n=e.onmousedown;if(typeof e.onmousedown!="function"){e.onmousedown=t}else{e.onmousedown=function(){if(n){n()}t()}}};var y=function(e){if(r&&console&&console.log){console.log("TrakkSocial: "+e)}};return{init:s}}(window,document)